(this["webpackJsonpreact-rb-auth-example"]=this["webpackJsonpreact-rb-auth-example"]||[]).push([[0],{21:function(e,t,n){e.exports=n.p+"static/media/udilia-logo.a02392f5.svg"},23:function(e,t,n){e.exports=n(37)},28:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(20),a=n.n(i),c=n(12);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(28);var u=n(10);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function h(e,t){try{var n=e()}catch(r){return t(r)}return n&&n.then?n.then(void 0,t):n}var f,p={role:"public"},d={accessToken:"",refreshToken:"",openIdToken:"",tokenType:"",expiresIn:"",scope:""},m=Object(r.createContext)({isAuth:!1,reloading:!0,user:p,logic:{login:function(){try{return Promise.resolve(console.log("please change login"))}catch(e){return Promise.reject(e)}},signup:function(){try{return Promise.resolve(console.log("please change signup"))}catch(e){return Promise.reject(e)}},logout:function(){try{return Promise.resolve(console.log("please change logout"))}catch(e){return Promise.reject(e)}},silent:function(){try{return Promise.resolve(console.log("please change silent"))}catch(e){return Promise.reject(e)}},handle:function(){try{return Promise.resolve(console.log("please change handle"))}catch(e){return Promise.reject(e)}},refresh:function(){try{return Promise.resolve(console.log("please change refresh"))}catch(e){return Promise.reject(e)}},apis:{}},routes:{public:"/",private:"/dashboard"},rules:{public:{static:["home-page:visit"]},admin:{static:["home-page:visit","dashboard-page:visit"]}}}),g=function(){function e(){}return e.setStorage=function(t){e.s=t},e.getTokens=function(){return{accessToken:e.s.accessToken||"",refreshToken:e.s.refreshToken||"",openIdToken:e.s.openIdToken||"",tokenType:e.s.tokenType||"",expiresIn:e.s.expiresIn||"",scope:e.s.scope||""}},e}();g.s={accessToken:"",refreshToken:"",openIdToken:"",tokenType:"",expiresIn:"",scope:"",setTokens:function(){return null}},g.setTokens=function(e){return void 0===e&&(e=d),g.s.setTokens(e)},function(e){e.INVALID_GRANT="invalid_grant",e.REFRESH_TOKEN_REVOKED="refreshTokenRevoked",e.REFRESH_TOKEN_NOT_PRESENT="noRefreshToken",e.UNAUTHORIZED="Unauthorized",e.TOO_MANY_REQUESTS="Too Many Requests",e.FAILLED_TO_FETCH="failled to fetch",e.UNKNOWN="UNKNOWN"}(f||(f={}));var v=function(){function e(){}return e.handle=function(t,n,r,o,i,a){return void 0===o&&(o=1),void 0===i&&(i=f.UNAUTHORIZED),void 0===a&&(a=f.INVALID_GRANT),function(c){return function(){try{return Promise.resolve(e.recursion(c,t,n,r,o,i,a))}catch(u){return Promise.reject(u)}}}},e}();v.recursion=function(e,t,n,r,o,i,a){void 0===o&&(o=1);try{return void 0===i&&(i=f.UNAUTHORIZED),void 0===a&&(a=f.INVALID_GRANT),Promise.resolve(h((function(){return Promise.resolve(t()).then((function(){}))}),(function(c){var u=!1;function s(e){if(u)return e;throw c}var l=function(){if(c.message===i&&o>=1)return h((function(){return Promise.resolve(e()).then((function(){return u=!0,v.recursion(e,t,n,r,o-1,i,a)}))}),(function(){throw r(f.REFRESH_TOKEN_REVOKED),new Error(f.REFRESH_TOKEN_REVOKED)}));r(c)}();return l&&l.then?l.then(s):s(l)})))}catch(c){return Promise.reject(c)}};var E=function(){function e(e){this.success=function(){return null},this.failure=function(){return null},this.recursions=1,this.accessTokenError=f.INVALID_GRANT,this.refreshTokenError=f.REFRESH_TOKEN_REVOKED,this.logic=e}var t=e.prototype;return t.withAccessTokenError=function(e){return this.accessTokenError=e,this},t.withRefreshTokenError=function(e){return this.refreshTokenError=e,this},t.withSuccess=function(e){return this.success=e,this},t.withFailure=function(e){return this.failure=e,this},t.withCustomRecursions=function(e){return this.recursions=e,this},t.build=function(e){return v.handle(this.logic,this.success,this.failure,this.recursions,this.accessTokenError,this.refreshTokenError)(e)},e}(),b=function(e){return new Promise((function(t){return t(e)}))},k=function(e){var t,n,r,o,i;function a(t,n,r,o,i){var a;return(a=e.call(this,t,n)||this).defaultLogin=b,a.defaultLogout=b,a.defaultSignupLogic=b,a.defaultSilentLogic=b,a.defaultHandleLogic=b,a.defaultRefreshLogic=b,a.loginLogic=a.defaultLogin,a.logoutLogic=a.defaultLogout,a.signupLogic=a.defaultSignupLogic,a.silentLogic=a.defaultSilentLogic,a.handleLogic=a.defaultHandleLogic,a.refreshLogic=a.defaultRefreshLogic,a.errorCallback=function(){return null},a.appApis={},a.login=function(){try{return Promise.resolve(a.runLogic(a.loginLogic).apply(void 0,arguments))}catch(e){return Promise.reject(e)}},a.handle=function(){try{return Promise.resolve(a.runLogic(a.handleLogic).apply(void 0,arguments))}catch(e){return Promise.reject(e)}},a.silent=function(){try{return Promise.resolve(a.runLogic(a.silentLogic).apply(void 0,arguments))}catch(e){return Promise.reject(e)}},a.signup=function(){var e;return(e=a).signupLogic.apply(e,arguments)},a.refresh=function(e){try{return Promise.resolve(a.runRefresh(a.refreshLogic)(e))}catch(t){return Promise.reject(t)}},a.logout=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{return Promise.resolve(a.wrap((function(){try{var e;return Promise.resolve((e=a).logoutLogic.apply(e,t)).then((function(e){return Promise.resolve(a.authenticate()).then((function(){return e}))}))}catch(n){return Promise.reject(n)}})))}catch(r){return Promise.reject(r)}},a.runLogic=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];try{return Promise.resolve(a.wrap((function(){try{return Promise.resolve(e.apply(void 0,n)).then((function(e){return Promise.resolve(a.authenticate(e)).then((function(){return e}))}))}catch(t){return Promise.reject(t)}})))}catch(o){return Promise.reject(o)}}},a.runRefresh=function(e){return function(t){try{return Promise.resolve(a.wrap((function(){try{return Promise.resolve(e()).then((function(e){var t=function(){if(e.refreshToken)return Promise.resolve(g.setTokens(e)).then((function(){}))}();return t&&t.then?t.then((function(){return e})):e}))}catch(t){return Promise.reject(t)}}),t))}catch(n){return Promise.reject(n)}}},a.accessTokenError=f.UNAUTHORIZED,a.refreshTokenError=f.INVALID_GRANT,a.apiWrap=function(e){return function(t,n){return new E(e).withSuccess(t).withFailure(n).withAccessTokenError(a.accessTokenError).withRefreshTokenError(a.refreshTokenError).build(a.refresh)}},a.wrap=function(e,t){void 0===t&&(t=!0);try{return t&&a.setReloading(!0),Promise.resolve(function(e,t){try{var n=e()}catch(r){return t(!0,r)}return n&&n.then?n.then(t.bind(null,!1),t.bind(null,!0)):t(!1,n)}((function(){return h(e,(function(e){throw"Failed to fetch"===e.message?a.errorCallback(f.FAILLED_TO_FETCH,e):e.message===f.UNAUTHORIZED?a.errorCallback(e):e.message===f.REFRESH_TOKEN_NOT_PRESENT||e.message!==f.REFRESH_TOKEN_NOT_PRESENT&&a.errorCallback(f.UNKNOWN,e),e}))}),(function(e,n){if(t&&a.setReloading(!1),e)throw n;return n})))}catch(n){return Promise.reject(n)}},a.authenticate=function(e){void 0===e&&(e=null);try{var t=e&&e.user&&e.tokens?(a.setUser(e.user),Promise.resolve(g.setTokens(e.tokens)).then((function(){}))):(a.setUser(null),Promise.resolve(g.setTokens(d)).then((function(){})));return Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(n){return Promise.reject(n)}},o&&(a.errorCallback=o),i&&(a.appApis=a.embedWrapperLogicIntoApis(i)),r?(r.login&&(a.loginLogic=r.login),r.logout&&(a.logoutLogic=r.logout),r.signup&&(a.signupLogic=r.signup),r.handle&&(a.handleLogic=r.handle),r.silent&&(a.silentLogic=r.silent),r.refresh&&(a.refreshLogic=r.refresh),a):function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a)}return n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),a.prototype.embedWrapperLogicIntoApis=function(e){var t=this,n={};return Object.keys(e).forEach((function(r){r.startsWith("logic")&&e[r]&&"function"===typeof e[r]?n[r]=t.apiWrap(e[r]):null!==e[r]&&"object"===typeof e[r]?n[r]=t.embedWrapperLogicIntoApis(e[r]):n[r]=e[r]})),n},r=a,(o=[{key:"apis",get:function(){return this.appApis}}])&&s(r.prototype,o),i&&s(r,i),a}((function(e,t){this.setReloading=e,this.setUser=t})),T=function(e){var t=e.children,n=e.authApi,i=e.routes,a=e.onAuthExpired,c=e.appApis,u=void 0===c?{}:c,s=e.monitorUserChanges,l=void 0===s?null:s,h=o.a.useState(!0),f=h[0],d=h[1],g=o.a.useState(null),v=g[0],E=g[1],b=new k(d,E,n,a,u);Object(r.useEffect)((function(){l&&l(v)}),[v]);var T={isAuth:!(!v||!v.role||"public"===v.role),reloading:f,logic:b,routes:{private:(null===i||void 0===i?void 0:i.private)||"/private",public:(null===i||void 0===i?void 0:i.public)||"/"},user:v||p,rules:{admin:{},public:{}}};return o.a.createElement(m.Provider,{value:T},t)},w=function(){};w.done=!1;var y,O=function(e){var t=e.children,n=e.locationPathName,i=e.AuthReloadingComp,a=e.AuthLoadingComp,c=void 0===a?void 0:a,u=e.authCallbackRoute,s=e.onRefreshFinished,l=e.debug,h=void 0!==l&&l,f=Object(r.useContext)(m),p=Object(r.useState)(!0),d=p[0],g=p[1];return Object(r.useEffect)((function(){f.reloading&&void 0!==c?g(!0):g(!1)}),[f.reloading,c]),Object(r.useEffect)((function(){if(!w.done&&n!==u){w.done=!0;var e=function(){};h&&(e=console.log),f.logic.silent().then(e).catch(e).finally((function(){h&&console.log("Finished refreshing"),s&&s()}))}}),[]),!w.done&&i?o.a.createElement(i,null):o.a.createElement(o.a.Fragment,null,d&&c&&o.a.createElement(c,null),t)},A=function(e){var t=e.Redirect,n=e.Allowed,r=e.NotAllowed;return o.a.createElement(m.Consumer,null,(function(e){var i;return e.isAuth?o.a.createElement(n,null):r?o.a.createElement(r,null):o.a.createElement(t,{to:(null===(i=e.routes)||void 0===i?void 0:i.public)||"/"})}))},P=function(){function e(){return this.headers=new Headers,this}var t=e.prototype;return t.withKeyValuePair=function(e,t){return this.headers.append(e,t),this},t.withContentTypeJson=function(){return this.headers.append("Content-Type","application/json"),this},t.withToken=function(e,t){return this.headers.append("Authorization",e+" "+t),this},t.withRBAuthToken=function(){return this.headers.append("Authorization",g.getTokens().tokenType+" "+g.getTokens().accessToken),this},t.build=function(){return this.headers},e}();!function(e){e.POST="POST",e.GET="GET",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.HEAD="HEAD",e.CONNECT="CONNECT",e.TRACE="TRACE"}(y||(y={}));var R=function(){function e(e,t){return void 0===t&&(t=!1),this.debug=t,this.route="",this.body=null,this.headers=new Headers,this.method=y.GET,this.mode=null,this.errorHandling=null,this.timeout=1e4,this.route=e,this}var t=e.prototype;return t.withAuth0Body=function(e){return void 0===e&&(e={}),this.body=e,this},t.withErrorHandling=function(e){return this.errorHandling=e,this},t.withBody=function(e){return void 0===e&&(e={}),this.body=e,this},t.withHeaders=function(e){return this.headers=e,this},t.withMethod=function(e){return this.method=e,this},t.withMode=function(e){return this.mode=e,this},t.withTimeout=function(e){return this.timeout=e,this},t.request=function(){if(this.debug){var e={};this.headers.forEach((function(t,n){return e[n]=t})),console.log("will request: ",this.route,this.method,JSON.stringify(e),JSON.stringify(this.body))}var t,n,r,o={method:this.method,headers:this.headers};return this.mode&&(o.mode=this.mode),this.method!==y.GET&&this.method!==y.HEAD&&this.body&&(o.body=JSON.stringify(this.body)),t=this.route,n=o,void 0===(r=this.timeout)&&(r=1e4),Promise.race([fetch(t,n),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),r)}))])},t.build=function(){try{var e=this;return Promise.resolve(e.request()).then((function(t){var n=t.headers.get("content-type"),r=t.ok;return n&&-1!==n.indexOf("application/json")?Promise.resolve(t.json()):Promise.resolve(t.text()).then((function(t){return r||(e.debug&&console.log(t),e.errorHandling&&e.errorHandling(t)),t}))}))}catch(t){return Promise.reject(t)}},e}(),j=n(2),S=n(21),N=n.n(S),x=(n(29),function(e){return o.a.createElement("div",{className:"Example"},e.children,o.a.createElement("img",{src:N.a,alt:"React logo",width:"62"}),o.a.createElement("h1",{className:"Example-text"},"React Role Based Auth Library"))}),I=(n(30),function(e){var t=e.children;return o.a.createElement("div",{style:{display:"flex"}},t)}),L=function(e){return o.a.createElement("div",{className:"SecondExample"},o.a.createElement("div",{className:"SecondExample-text"},o.a.createElement(I,null)),o.a.createElement("a",{className:"SecondExample-github-link",target:"_blank",rel:"noopener noreferrer",href:"https://github.com/nmpribeiro/react-role-based-auth/blob/master/README.md"},"Documentation"),e.children)},_=m,C=function(){var e=Object(r.useContext)(_).logic,t=Object(r.useState)(""),n=Object(u.a)(t,2),i=n[0],a=n[1],c=Object(r.useState)(""),s=Object(u.a)(c,2),l=s[0],h=s[1],f=function(e){return function(t){return e(t.target.value)}};return o.a.createElement("div",null,o.a.createElement("h3",null,"You are anonymous"),o.a.createElement("h3",null,"Please login"),o.a.createElement("input",{value:i,type:"text",onChange:f(a)}),o.a.createElement("input",{value:l,type:"password",onChange:f(h)}),o.a.createElement("button",{onClick:function(){return e.login(i,l)}},"Login"))};function H(e){return"".concat(e.length<2?"0":"").concat(e)}var F=function(e){if(null===e)return"";var t=(e.getMonth()+1).toString(),n=e.getDate().toString(),r=(e.getHours()+1).toString(),o=(e.getMinutes()+1).toString(),i=(e.getSeconds()+1).toString(),a=[e.getFullYear(),H(t),H(n)].join("-"),c="".concat(H(r),":").concat(H(o),":").concat(H(i));return"".concat(a," ").concat(c)},U=function(){var e=Object(r.useContext)(_),t=Object(r.useState)(null),n=Object(u.a)(t,2),i=n[0],a=n[1];return o.a.createElement("div",null,o.a.createElement("h3",null,"Welcome USER!"),o.a.createElement("h5",null,"Your name is: ",e.user.name),o.a.createElement("img",{style:{maxHeight:100,borderRadius:50},src:e.user.picture,alt:e.user.name}),o.a.createElement("h5",null,"Your slug is: ",e.user.nickname),o.a.createElement("button",{onClick:function(){return e.logic.logout().then((function(){return null})).catch((function(){return null}))}},"Logout"),o.a.createElement("div",null,o.a.createElement("button",{onClick:function(){return e.logic.refresh().then(console.log).catch(console.log)}},"Refresh tokens"),o.a.createElement("button",{onClick:function(){e.logic.apis.external.getUser().then((function(e){return a({nickname:e.nickname,date:new Date,lastFetched:(null===i||void 0===i?void 0:i.date)||null})})).catch(console.log)}},"Get user"),i&&o.a.createElement("div",null,o.a.createElement("h3",null,"Got user: "),o.a.createElement("h5",null,i.nickname),o.a.createElement("p",null,"Last retrieved:","\t".concat(F(i.lastFetched))),o.a.createElement("p",null,"Retrieved:","\t\t".concat(F(i.date))))))},D=function(){return o.a.createElement(_.Consumer,null,(function(e){return o.a.createElement(o.a.Fragment,null,e.isAuth&&o.a.createElement(U,null),!e.isAuth&&o.a.createElement(C,null))}))},M=function(e){var t=e.children,n=e.AuthReloadingComp,r=e.authCallbackRoute,i=Object(j.g)();return o.a.createElement(O,{locationPathName:i.pathname,AuthReloadingComp:n,authCallbackRoute:r},t)},K=function(e){var t=e.to;return o.a.createElement(j.a,{to:t})},G=function(e){var t=e.path,n=e.Allowed,r=e.NotAllowed;return o.a.createElement(j.b,{to:t,render:function(){return o.a.createElement(A,{Allowed:n,Redirect:K,NotAllowed:r})}})},W=function(){return o.a.createElement("div",null,o.a.createElement("h3",null,"Reloading..."),o.a.createElement("br",null),o.a.createElement("br",null))},J=function(e){var t=e.children;return o.a.createElement("div",{className:"appMenu"},t)},V=function(e){var t=e.to,n=e.label;return o.a.createElement("div",{className:"appLink"},o.a.createElement(c.b,{to:t},n))},B=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(x,null),o.a.createElement("div",{className:"Example appBounding"},o.a.createElement(J,null,o.a.createElement(V,{to:"/",label:"Home"}),o.a.createElement(V,{to:"/secure",label:"Secure"}),o.a.createElement(V,{to:"/super-secure",label:"Super Secure"})),o.a.createElement(M,{AuthReloadingComp:W},o.a.createElement(j.d,null,o.a.createElement(G,{path:"/secure",Allowed:function(){return o.a.createElement("h3",null,"Secure area")},NotAllowed:function(){return o.a.createElement("h3",null,"You are not allowed")}}),o.a.createElement(G,{path:"/super-secure",Allowed:function(){return o.a.createElement("h3",null,"Super Secure area")}})),o.a.createElement(D,null))),o.a.createElement(L,null))},Z=n(9),q=n(1),Y=n.n(q),z=n(4),Q=n(8),X={nickname:"anon",name:"",role:"public",picture:"https://s.gravatar.com/avatar/af17b538f2e14a4a5c4a23799233af63?s=480&r=pg&d=https%3A%2F%2Fcdn.auth0.com%2Favatars%2Fnu.png",sub:"",updated_at:new Date},$=n(14),ee="react-rb-auth.eu.auth0.com",te="IQHjsH8rbRctSLd2dqErP3SC6WJ4mqx5",ne=function(){function e(){Object(Q.a)(this,e)}return Object($.a)(e,null,[{key:"mapTokens",value:function(e){return{accessToken:e.access_token,refreshToken:e.refresh_token,openIdToken:e.id_token,scope:e.scope,expiresIn:e.expires_in,tokenType:e.token_type}}}]),e}();ne.connection="Username-Password-Authentication",ne.scope="profile openid offline_access",ne.auth0body={client_id:te,audience:"https://react-rb-auth.eu.auth0.com/api/v2/"},ne.authorize=function(e,t){return new R("https://".concat(ee,"/oauth/token")).withMethod(y.POST).withHeaders((new P).withContentTypeJson().build()).withAuth0Body(Object(Z.a)(Object(Z.a)({},ne.auth0body),{},{connection:ne.connection,scope:ne.scope,grant_type:"password",username:e,password:t})).withErrorHandling((function(e){if(e.error)throw Error(e.error)})).build()},ne.refresh=Object(z.a)(Y.a.mark((function e(){var t,n,r=arguments;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r.length>0&&void 0!==r[0]?r[0]:g.getTokens().refreshToken)&&""!==t){e.next=3;break}throw new Error("noRefreshToken");case 3:return e.next=5,new R("https://".concat(ee,"/oauth/token")).withMethod(y.POST).withHeaders((new P).withContentTypeJson().build()).withBody({grant_type:"refresh_token",client_id:te,refresh_token:t}).withErrorHandling((function(e){if(e.error&&(console.log("Auth0Api::refresh result.error: ",e.error),"invalid_grant"===e.error))throw Error(f.INVALID_GRANT)})).build();case 5:return n=e.sent,e.abrupt("return",ne.mapTokens(n));case 7:case"end":return e.stop()}}),e)}))),ne.logout=Object(z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new R("https://".concat(ee,"/v2/logout")).withMode("no-cors").build());case 1:case"end":return e.stop()}}),e)}))),ne.revoke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.getTokens();return e.refreshToken&&new R("https://".concat(ee,"/oauth/revoke"),!0).withMethod(y.POST).withBody({client_id:te,client_secret:"gCZVMcdV2q9n7G7jjnZrYEwee1FdAOGV7-b7AnMhJZIzAIGBE6Fb4LMTeIr0XIn0",token:e.refreshToken}).withHeaders((new P).withContentTypeJson().withKeyValuePair("origin","http://localhost:3000").build()).withMode("same-origin").withErrorHandling((function(e){if(e.error)throw Error(e.error)})).build()},ne.signup=function(e,t,n){return new R("https://".concat(ee,"/dbconnections/signup")).withMethod(y.POST).withHeaders((new P).withContentTypeJson().build()).withAuth0Body(Object(Z.a)(Object(Z.a)({},ne.auth0body),{},{connection:ne.connection,scope:ne.scope,grant_type:"password",device:"mydevice",email:t,name:e,password:n})).withErrorHandling((function(e){if(e.error)throw Error(e.error)})).build()},ne.getUser=function(e,t){return new R("https://".concat(ee,"/userinfo")).withMethod(y.GET).withHeaders((new P).withToken(e,t).build()).withErrorHandling((function(e){if(e.error)throw Error(e.error)})).build()},ne.getUserInfo=function(e,t,n){return new R("https://".concat(ee,"/api/v2/users/").concat(n)).withMethod(y.GET).withHeaders((new P).withToken(e,t).withContentTypeJson().build()).withErrorHandling((function(e){if(e.error)throw Error(e.error)})).build()};var re=function e(){Object(Q.a)(this,e)};re.login=function(){var e=Object(z.a)(Y.a.mark((function e(t,n){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.authWrapper(Object(z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ne,e.next=3,ne.authorize(t,n);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.mapTokens.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),re.silent=Object(z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.authWrapper(Object(z.a)(Y.a.mark((function e(){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.refresh());case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e)}))),re.logout=function(){return ne.logout()},re.signup=function(e,t,n){return ne.signup(e,t,n)},re.refresh=function(){return ne.refresh()},re.authWrapper=function(){var e=Object(z.a)(Y.a.mark((function e(t){var n,r,o,i;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return n=e.sent,r=X,e.prev=4,e.next=7,t();case 7:return n=e.sent,e.next=10,ne.getUser(n.tokenType,n.accessToken);case 10:return o=e.sent,e.next=13,ne.getUserInfo(n.tokenType,n.accessToken,o.sub);case 13:i=e.sent,r=Object(Z.a)(Object(Z.a)({},o||X),{},{role:re.getRole(i)}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),console.log("authWrapper catch: ",e.t0);case 20:return e.abrupt("return",{tokens:n,user:r});case 21:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(t){return e.apply(this,arguments)}}(),re.getRole=function(e){var t=X.role;return e&&e.user_metadata&&e.user_metadata.role&&(t=e.user_metadata.role),t};var oe={external:new function e(){Object(Q.a)(this,e),this.getUser=function(){return new R("https://".concat("react-rb-auth.eu.auth0.com","/userinfo")).withMethod(y.GET).withHeaders((new P).withRBAuthToken().build()).build()}}},ie=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react_rb_auth_tokens";Object(Q.a)(this,e),this.tokensKey=void 0,this.accessToken="",this.refreshToken="",this.openIdToken="",this.tokenType="",this.expiresIn="",this.scope="",this.setItem=function(){var e=Object(z.a)(Y.a.mark((function e(t){var n,r=arguments;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:{},!t||!n){e.next=5;break}return e.abrupt("return",localStorage.setItem(t,JSON.stringify(n)));case 5:return e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.tokensKey=n,this.init(t)}return Object($.a)(e,[{key:"init",value:function(){var e=Object(z.a)(Y.a.mark((function e(t){return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loadTokensFromStorage().then((function(){return t(!0)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadTokensFromStorage",value:function(){var e=Object(z.a)(Y.a.mark((function e(){var t,n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=localStorage.getItem(this.tokensKey))&&t.length>0&&(n=JSON.parse(t),console.log("AppStorage::loadTokensFromStorage tokens => ",n.refreshToken),this.refreshToken=n.refreshToken,this.accessToken=n.accessToken,this.openIdToken=n.openIdToken,this.expiresIn=n.expiresIn,this.scope=n.scope,this.tokenType=n.tokenType),g.setStorage(this);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setTokens",value:function(){var e=Object(z.a)(Y.a.mark((function e(t){var n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.accessToken&&(this.accessToken=t.accessToken),t.expiresIn&&(this.expiresIn=t.expiresIn),t.openIdToken&&(this.openIdToken=t.openIdToken),t.tokenType&&(this.tokenType=t.tokenType),t.scope&&(this.scope=t.scope),t.refreshToken&&(this.refreshToken=t.refreshToken);try{n={refreshToken:t.refreshToken},this.setItem(this.tokensKey,n)}catch(r){console.log("error while saving to your storage: ",r)}case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ae=function(){return o.a.createElement(ue,null,o.a.createElement("h3",null,"AuthReloading"))},ce=function(){return o.a.createElement(ue,null,o.a.createElement("h3",null,"AuthLoading"))},ue=function(e){var t=e.children;return o.a.createElement("div",{style:{position:"absolute",display:"flex",top:0,bottom:0,left:0,right:0,backgroundColor:"white"}},o.a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"center",alignItems:"center"}},t))},se=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],i=t[1];Object(r.useEffect)((function(){g.setStorage(new ie(i))}),[]),Object(r.useEffect)((function(){console.log("is initiated: ",n)}),[n]);return n?o.a.createElement(T,{authApi:re,routes:{private:"/super-secure",public:"/"},onAuthExpired:function(e,t){return setTimeout((function(){alert(e),t&&console.log(t)}))},appApis:oe},o.a.createElement(O,{locationPathName:"none",AuthReloadingComp:ae,AuthLoadingComp:ce,onRefreshFinished:function(){return console.log("Main::onRefreshFinished")},debug:!0},o.a.createElement(B,null))):o.a.createElement(o.a.Fragment,null)};a.a.render(o.a.createElement(c.a,null,o.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[23,1,2]]]);
//# sourceMappingURL=main.ad9d62b6.chunk.js.map